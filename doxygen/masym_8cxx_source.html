<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>cnipol: /direct/eic+u/dsmirnov/cnipol/src/masym.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_e1dca166ec6abb4ef5a7ad269392aef6.html">src</a>
  </div>
</div>
<div class="contents">
<h1>masym.cxx</h1><a href="masym_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;<a class="code" href="masym_8h.html">masym.h</a>&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;TEnv.h&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;TROOT.h&quot;</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="CnipolAsymHists_8h.html">CnipolAsymHists.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="MAsymFillHists_8h.html">MAsymFillHists.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="MAsymRunHists_8h.html">MAsymRunHists.h</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="MAsymRateHists_8h.html">MAsymRateHists.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="MAsymPmtHists_8h.html">MAsymPmtHists.h</a>&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="AnaGlobResult_8h.html">AnaGlobResult.h</a>&quot;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="AsymDbSql_8h.html">AsymDbSql.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="AsymGlobals_8h.html">AsymGlobals.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="MAsymAnaInfo_8h.html">MAsymAnaInfo.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="MeasInfo_8h.html">MeasInfo.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;utils/utils.h&quot;</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00030"></a><a class="code" href="masym_8cxx.html#a0ddf1224851353fc92bfbff6f499fa97">00030</a> <span class="keywordtype">int</span> <a class="code" href="asym_8cxx.html#a0ddf1224851353fc92bfbff6f499fa97" title="The main function of `asym`.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00031"></a>00031 {
<a name="l00032"></a>00032    setbuf(stdout, NULL);
<a name="l00033"></a>00033 
<a name="l00034"></a>00034    <span class="comment">// Create a default one</span>
<a name="l00035"></a>00035    <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a> = <span class="keyword">new</span> <a class="code" href="classMeasInfo.html">MeasInfo</a>();
<a name="l00036"></a>00036 
<a name="l00037"></a>00037    <span class="comment">// Do not attempt to recover files</span>
<a name="l00038"></a>00038    gEnv-&gt;SetValue(<span class="stringliteral">&quot;TFile.Recover&quot;</span>, 0);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040    <a class="code" href="classMAsymAnaInfo.html" title="This class takes care of the command line options specific to the &amp;#39;masym&amp;#39;...">MAsymAnaInfo</a> mAsymAnaInfo;
<a name="l00041"></a>00041    mAsymAnaInfo.<a class="code" href="classMAsymAnaInfo.html#a38b38f9aff1397d3272e9e3d9459d366">ProcessOptions</a>(argc, argv);
<a name="l00042"></a>00042    mAsymAnaInfo.<a class="code" href="classMAsymAnaInfo.html#ab22b334314bef4f7a5c8a45508bd7e4d">VerifyOptions</a>();
<a name="l00043"></a>00043 
<a name="l00044"></a>00044    <a class="code" href="AsymCommon_8cxx.html#a658bc78faf3eb804b201234240205dda">gMAsymAnaInfo</a> = &amp;mAsymAnaInfo;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046    <a class="code" href="classAnaGlobResult.html">AnaGlobResult</a> anaGlobResult;
<a name="l00047"></a>00047    anaGlobResult.<a class="code" href="classAnaGlobResult.html#ae2045a745bf98cfb750aee464b7e9d82">Configure</a>(mAsymAnaInfo);
<a name="l00048"></a>00048 
<a name="l00049"></a>00049    gROOT-&gt;Macro(<span class="stringliteral">&quot;~/rootmacros/styles/style_masym.C&quot;</span>);
<a name="l00050"></a>00050 
<a name="l00051"></a>00051    <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a18869899b490de85f84277c3b4def02b">fBeamEnergies</a>.clear();
<a name="l00052"></a>00052    <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a18869899b490de85f84277c3b4def02b">fBeamEnergies</a>.insert(<a class="code" href="AsymCommon_8h.html#a27fa7e1c3dafe1ff85fce6d38d8af11ca4103a22544dbf81b29558b16da96fb66">kINJECTION</a>);
<a name="l00053"></a>00053    <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a18869899b490de85f84277c3b4def02b">fBeamEnergies</a>.insert(<a class="code" href="AsymCommon_8h.html#a27fa7e1c3dafe1ff85fce6d38d8af11ca6f7be2e6c45985eb51bba41ae40e70a6">kBEAM_ENERGY_255</a>);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055    std::string filelist     = mAsymAnaInfo.<a class="code" href="classMAsymAnaInfo.html#a7ebaa350196217aea4981ec5d11e80e7">GetMListFullPath</a>();
<a name="l00056"></a>00056 
<a name="l00057"></a>00057    <a class="code" href="classMAsymRoot.html">MAsymRoot</a> mAsymRoot(mAsymAnaInfo);
<a name="l00058"></a>00058    mAsymRoot.<a class="code" href="classMAsymRoot.html#aad6eb84f523a025da1022932db54d9dd">SetAnaGlobResult</a>(&amp;anaGlobResult);
<a name="l00059"></a>00059 
<a name="l00060"></a>00060    Info(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Starting first pass...&quot;</span>);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062    <span class="comment">// Container with measurements passed QA cuts. Used to save time on opening</span>
<a name="l00063"></a>00063    <span class="comment">// input files in the second pass</span>
<a name="l00064"></a>00064    std::set&lt;EventConfig&gt; gGoodMeass;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066    <span class="comment">// Fill chain with all input files from filelist</span>
<a name="l00067"></a>00067    TObject *o;
<a name="l00068"></a>00068    TIter   *next = <span class="keyword">new</span> TIter(utils::getFileList(filelist));
<a name="l00069"></a>00069 
<a name="l00070"></a>00070    <span class="comment">// Loop over the runs and record the time of the last flattop measurement in the fill</span>
<a name="l00071"></a>00071    <span class="keywordflow">while</span> (next &amp;&amp; (o = (*next)()) )
<a name="l00072"></a>00072    {
<a name="l00073"></a>00073       std::string measId   = std::string(((TObjString*) o)-&gt;GetName());
<a name="l00074"></a>00074       std::string fileName = mAsymAnaInfo.<a class="code" href="classAnaInfo.html#a3166a8e06fd7de2f53b821606724aa14">GetResultsDir</a>() + <span class="stringliteral">&quot;/&quot;</span> + measId + <span class="stringliteral">&quot;/&quot;</span> + measId + mAsymAnaInfo.<a class="code" href="classAnaInfo.html#a16f9cc05b44332a215ddd8c23a3fe7cf">GetSuffix</a>() + <span class="stringliteral">&quot;.root&quot;</span>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076       <span class="comment">// Check for fills of no interest</span>
<a name="l00077"></a>00077       std::stringstream ssMeasId(measId);
<a name="l00078"></a>00078       Int_t        nFillId;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       ssMeasId &gt;&gt; nFillId;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082       <span class="keywordflow">if</span> ( nFillId &gt;= 17064 &amp;&amp; nFillId &lt;= 17084 ) {
<a name="l00083"></a>00083          Error(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Encountered vetoed fillId: %d. Skipping...&quot;</span>, nFillId);
<a name="l00084"></a>00084          <span class="keywordflow">continue</span>;
<a name="l00085"></a>00085       }
<a name="l00086"></a>00086 
<a name="l00087"></a>00087       TFile *f = <span class="keyword">new</span> TFile(fileName.c_str(), <span class="stringliteral">&quot;READ&quot;</span>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089       <span class="keywordflow">if</span> (!f) {
<a name="l00090"></a>00090          Error(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;file not found. Skipping...&quot;</span>);
<a name="l00091"></a>00091          <span class="keyword">delete</span> f;
<a name="l00092"></a>00092          <span class="keywordflow">continue</span>;
<a name="l00093"></a>00093       }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095       <span class="keywordflow">if</span> (f-&gt;IsZombie()) {
<a name="l00096"></a>00096          Error(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;file is zombie %s. Skipping...&quot;</span>, fileName.c_str());
<a name="l00097"></a>00097          f-&gt;Close();
<a name="l00098"></a>00098          <span class="keyword">delete</span> f;
<a name="l00099"></a>00099          <span class="keywordflow">continue</span>;
<a name="l00100"></a>00100       }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102       Info(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Found file: %s&quot;</span>, fileName.c_str());
<a name="l00103"></a>00103 
<a name="l00104"></a>00104       <a class="code" href="classEventConfig.html">EventConfig</a> *gMM = (<a class="code" href="classEventConfig.html">EventConfig</a>*) f-&gt;FindObjectAny(<span class="stringliteral">&quot;measConfig&quot;</span>);
<a name="l00105"></a>00105 
<a name="l00106"></a>00106       <span class="keywordflow">if</span> (!gMM) {
<a name="l00107"></a>00107          Error(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;MM not found. Skipping...&quot;</span>);
<a name="l00108"></a>00108          f-&gt;Close();
<a name="l00109"></a>00109          <span class="keyword">delete</span> f;
<a name="l00110"></a>00110          <span class="keywordflow">continue</span>;
<a name="l00111"></a>00111       }
<a name="l00112"></a>00112 
<a name="l00113"></a>00113       <span class="keywordtype">char</span> strTime[80];
<a name="l00114"></a>00114       strftime(strTime, 80, <span class="stringliteral">&quot;%X&quot;</span>, localtime(&amp;gMM-&gt;fMeasInfo-&gt;fStartTime));
<a name="l00115"></a>00115 
<a name="l00116"></a>00116       Double_t    runId           = gMM-&gt;fMeasInfo-&gt;RUNID;
<a name="l00117"></a>00117       UInt_t      fillId          = (UInt_t) runId;
<a name="l00118"></a>00118       <a class="code" href="AsymCommon_8h.html#a27fa7e1c3dafe1ff85fce6d38d8af11c">EBeamEnergy</a> beamEnergy      = gMM-&gt;fMeasInfo-&gt;GetBeamEnergy();
<a name="l00119"></a>00119 
<a name="l00120"></a>00120       Float_t polarization    = 0;
<a name="l00121"></a>00121       Float_t polarizationErr = -1;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123       TFitResultPtr fitResPolarPhi = gMM-&gt;fAnaMeasResult-&gt;fFitResPolarPhi;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125       <span class="keywordflow">if</span> (fitResPolarPhi.Get()) {
<a name="l00126"></a>00126          polarization    = fitResPolarPhi-&gt;Value(0) * 100;
<a name="l00127"></a>00127          polarizationErr = fitResPolarPhi-&gt;FitResult::Error(0) * 100;
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130       Float_t profileRatio     = gMM-&gt;fAnaMeasResult-&gt;fProfilePolarR.first;
<a name="l00131"></a>00131       Float_t profileRatioErr  = gMM-&gt;fAnaMeasResult-&gt;fProfilePolarR.second;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133       <span class="comment">// the cut on polarization value should be removed</span>
<a name="l00134"></a>00134       <span class="comment">//if (polarization &gt; 99 || polarizationErr &gt; 30 ||</span>
<a name="l00135"></a>00135       <span class="keywordflow">if</span> (polarization &lt; 10 || polarization &gt; 99 || polarizationErr &gt; 30 ||
<a name="l00136"></a>00136           <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a18869899b490de85f84277c3b4def02b">fBeamEnergies</a>.find(beamEnergy) == <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a18869899b490de85f84277c3b4def02b">fBeamEnergies</a>.end() ||
<a name="l00137"></a>00137           gMM-&gt;fMeasInfo-&gt;fMeasType != kMEASTYPE_SWEEP ||
<a name="l00138"></a>00138           (TMath::Abs(profileRatio) &gt; 5.000) ||                             <span class="comment">// exclude very large values</span>
<a name="l00139"></a>00139           (TMath::Abs(profileRatio) &gt; 1.000 &amp;&amp; profileRatioErr &lt; 0.05) ||   <span class="comment">// exclude large values with small errors</span>
<a name="l00140"></a>00140           (TMath::Abs(profileRatio) &gt; 1.000 &amp;&amp; profileRatioErr &gt; 0.50) ||   <span class="comment">// exclude large values with large errors</span>
<a name="l00141"></a>00141           <span class="comment">//(profileRatioErr/TMath::Abs(profileRatio) &gt; 2.000 &amp;&amp; TMath::Abs(profileRatio) &gt; 1.0) ||</span>
<a name="l00142"></a>00142           profileRatioErr &lt; 0.01 || profileRatioErr &gt; 10 ||                 <span class="comment">// exclude too small and too big errors. probably from failed fits?</span>
<a name="l00143"></a>00143           <span class="comment">//(TMath::Abs(profileRatio) &lt; 0.001 &amp;&amp; profileRatioErr &lt; 0.01)</span>
<a name="l00144"></a>00144           ( fillId &gt;= 17064 &amp;&amp; fillId &lt;= 17084 )
<a name="l00145"></a>00145          )
<a name="l00146"></a>00146       {
<a name="l00147"></a>00147          Warning(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Measurement %9.3f did not pass basic QA check&quot;</span>, runId);
<a name="l00148"></a>00148          printf(<span class="stringliteral">&quot;%8.3f, %s, %3d, %f, %f, %s, %f, %f\n&quot;</span>,
<a name="l00149"></a>00149                 runId, strTime, beamEnergy, polarization, polarizationErr,
<a name="l00150"></a>00150                 <a class="code" href="classRunConfig.html#addc30f5997de7f4267c442a285434fb2">RunConfig::AsString</a>(gMM-&gt;fMeasInfo-&gt;fMeasType).c_str(), profileRatio,
<a name="l00151"></a>00151                 profileRatioErr );
<a name="l00152"></a>00152 
<a name="l00153"></a>00153          f-&gt;Close();
<a name="l00154"></a>00154          <span class="keyword">delete</span> f;
<a name="l00155"></a>00155          <span class="keywordflow">continue</span>;
<a name="l00156"></a>00156       }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       mAsymRoot.<a class="code" href="classMAsymRoot.html#a9d457876b35b93bd47f13a160562d2ee">UpdMinMax</a>(*gMM);
<a name="l00159"></a>00159 
<a name="l00160"></a>00160       <span class="comment">// Check that asym hist container exists in this file</span>
<a name="l00161"></a>00161       <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a> *gHIn = <span class="keyword">new</span> <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a>(f);
<a name="l00162"></a>00162       gHIn-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;asym&quot;</span>] = <span class="keyword">new</span> <a class="code" href="classCnipolAsymHists.html">CnipolAsymHists</a>();
<a name="l00163"></a>00163       gHIn-&gt;<a class="code" href="classDrawObjContainer.html#ab55861a58dd006010bfc730a896b7ae3">ReadFromDir</a>();
<a name="l00164"></a>00164 
<a name="l00165"></a>00165       <span class="comment">// To calculate normalization factors for p-Carbon we need to save all</span>
<a name="l00166"></a>00166       <span class="comment">// p-Carbon measurements in the first pass</span>
<a name="l00167"></a>00167       anaGlobResult.<a class="code" href="classAnaGlobResult.html#a83f8c9f9bfe71e1b575b4802bfb8c75b">AddMeasResult</a>(*gMM, gHIn);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169       <span class="keyword">delete</span> gHIn;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171       f-&gt;Close();
<a name="l00172"></a>00172       <span class="keyword">delete</span> f;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       gGoodMeass.insert(*gMM);
<a name="l00175"></a>00175    }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177    <span class="comment">// Update global run parameters before anything else</span>
<a name="l00178"></a>00178    <a class="code" href="AsymCommon_8cxx.html#a1f6d9a5740e1ea08450a3639a1683ab9">gRunConfig</a>.<a class="code" href="classRunConfig.html#a8dc4e5a5cc9cf5300988c04d3bb020aa">SetBeamEnergies</a>(anaGlobResult.<a class="code" href="classAnaGlobResult.html#a684e59b973edb80654862ff86caaa9fa">GetBeamEnergies</a>());
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <span class="comment">// Create graphic containers</span>
<a name="l00181"></a>00181    <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a> *gH = <span class="keyword">new</span> <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a>(&amp;mAsymRoot);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183    gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;fills&quot;</span>] = <span class="keyword">new</span> <a class="code" href="classMAsymFillHists.html">MAsymFillHists</a>(<span class="keyword">new</span> TDirectoryFile(<span class="stringliteral">&quot;fills&quot;</span>, <span class="stringliteral">&quot;fills&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, &amp;mAsymRoot));
<a name="l00184"></a>00184    gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;rate&quot;</span>]  = <span class="keyword">new</span> <a class="code" href="classMAsymRateHists.html">MAsymRateHists</a>(<span class="keyword">new</span> TDirectoryFile(<span class="stringliteral">&quot;rate&quot;</span>,  <span class="stringliteral">&quot;rate&quot;</span>,  <span class="stringliteral">&quot;&quot;</span>, &amp;mAsymRoot));
<a name="l00185"></a>00185    gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;runs&quot;</span>]  = <span class="keyword">new</span> <a class="code" href="classMAsymRunHists.html">MAsymRunHists</a> (<span class="keyword">new</span> TDirectoryFile(<span class="stringliteral">&quot;runs&quot;</span>,  <span class="stringliteral">&quot;runs&quot;</span>,  <span class="stringliteral">&quot;&quot;</span>, &amp;mAsymRoot));
<a name="l00186"></a>00186    gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;pmt&quot;</span>]   = <span class="keyword">new</span> <a class="code" href="classMAsymPmtHists.html">MAsymPmtHists</a> (<span class="keyword">new</span> TDirectoryFile(<span class="stringliteral">&quot;pmt&quot;</span>,   <span class="stringliteral">&quot;pmt&quot;</span>,   <span class="stringliteral">&quot;&quot;</span>, &amp;mAsymRoot));
<a name="l00187"></a>00187 
<a name="l00188"></a>00188    <span class="comment">// Adjust min/max fill for histogram limits</span>
<a name="l00189"></a>00189    ((<a class="code" href="classMAsymRunHists.html">MAsymRunHists</a>*) gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;runs&quot;</span>])-&gt;SetMinMaxFill(anaGlobResult.<a class="code" href="classAnaGlobResult.html#ad21d971b386ddc9cbae5d4c496194c85">GetMinFill</a>(), anaGlobResult.<a class="code" href="classAnaGlobResult.html#ad4366255aa59070ff11516b9b0866135">GetMaxFill</a>());
<a name="l00190"></a>00190    ((<a class="code" href="classMAsymRunHists.html">MAsymRunHists</a>*) gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;runs&quot;</span>])-&gt;SetMinMaxTime(anaGlobResult.<a class="code" href="classAnaGlobResult.html#aee1c1ef0c4756e17a24ec02bc7be12bf">GetMinTime</a>(), anaGlobResult.<a class="code" href="classAnaGlobResult.html#a5242483fd0938f4ba35ec3ffa314ba96">GetMaxTime</a>());
<a name="l00191"></a>00191    ((<a class="code" href="classMAsymRunHists.html">MAsymRunHists</a>*) gH-&gt;<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>[<span class="stringliteral">&quot;runs&quot;</span>])-&gt;AdjustMinMaxFill();
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    <span class="comment">// Process run/fill results, i.e. calculate fill average, ...</span>
<a name="l00194"></a>00194    Info(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Analyzing measurements...&quot;</span>);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196    anaGlobResult.<a class="code" href="classAnaGlobResult.html#acd053f8b7bac45ed1d05bec641ffac3d">AddHJMeasResult</a>();
<a name="l00197"></a>00197    anaGlobResult.<a class="code" href="classAnaGlobResult.html#ae005974f449e78926da7ba5b5e759e09">Process</a>(gH);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199    Info(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Starting second pass...&quot;</span>);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <span class="comment">// Now process only good runs</span>
<a name="l00202"></a>00202    std::set&lt;EventConfig&gt;::const_iterator iMeas = gGoodMeass.begin();
<a name="l00203"></a>00203 
<a name="l00204"></a>00204    <span class="keywordflow">for</span> ( ; iMeas!=gGoodMeass.end(); ++iMeas) {
<a name="l00205"></a>00205       <span class="comment">// Overwrite the default gMeasInfo with the saved one</span>
<a name="l00206"></a>00206       <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a> = iMeas-&gt;fMeasInfo;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       Info(<span class="stringliteral">&quot;masym&quot;</span>, <span class="stringliteral">&quot;Processing measurement: %.3f&quot;</span>, iMeas-&gt;fMeasInfo-&gt;RUNID);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210       gH-&gt;<a class="code" href="classDrawObjContainer.html#a22254ee0ef8b15ed2a2e30cf2fb1d16a">Fill</a>((<span class="keyword">const</span> <a class="code" href="classEventConfig.html">EventConfig</a>&amp;) *iMeas);
<a name="l00211"></a>00211    }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    gH-&gt;<a class="code" href="classDrawObjContainer.html#ab5bd1f5427193442d9432c0b5b97eee7">PostFill</a>(anaGlobResult);
<a name="l00214"></a>00214    gH-&gt;<a class="code" href="classDrawObjContainer.html#ab5bd1f5427193442d9432c0b5b97eee7">PostFill</a>();
<a name="l00215"></a>00215    gH-&gt;<a class="code" href="classDrawObjContainer.html#af297fb4cc0a6e4ee571d16cfcbc6f298">UpdateLimits</a>();
<a name="l00216"></a>00216 
<a name="l00217"></a>00217    mAsymRoot.<a class="code" href="classMAsymRoot.html#a1f24327db47417e4fdce69c1c5bd57ae">SetHists</a>(*gH);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <span class="keywordflow">if</span> (mAsymAnaInfo.<a class="code" href="classAnaInfo.html#afc4ef0e3ae228ded2b946629157cc34a">HasGraphBit</a>())
<a name="l00220"></a>00220       mAsymRoot.<a class="code" href="classMAsymRoot.html#ab44f20f5b01e4649d92292e3447a21e1">SaveAs</a>(<span class="stringliteral">&quot;^.*$&quot;</span>, mAsymAnaInfo.<a class="code" href="classAnaInfo.html#a1e35a888e0ab1bd4a718479d181d5935">GetImageDir</a>());
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="keywordflow">if</span> (mAsymAnaInfo.<a class="code" href="classAnaInfo.html#a1dffa6690e63d2f42240faa3d587c2e9">fFlagUpdateDb</a>) {
<a name="l00223"></a>00223       <a class="code" href="classAsymDbSql.html" title="select information about run periods from an ascii file.">AsymDbSql</a> *asymDbSql = <span class="keyword">new</span> <a class="code" href="classAsymDbSql.html" title="select information about run periods from an ascii file.">AsymDbSql</a>();
<a name="l00224"></a>00224       anaGlobResult.<a class="code" href="classAnaGlobResult.html#a3a16147935581b64b4d38d3b64c6a155">UpdateInsertDb</a>(asymDbSql);
<a name="l00225"></a>00225    }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    gH-&gt;<a class="code" href="classDrawObjContainer.html#a5669e588bf5360927953d5ba354fa997">Write</a>();
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    mAsymRoot.<a class="code" href="classMAsymRoot.html#a68009af9c90c35422da01d67dbd88a14">Print</a>();
<a name="l00230"></a>00230    mAsymRoot.Close();
<a name="l00231"></a>00231 
<a name="l00232"></a>00232    anaGlobResult.<a class="code" href="classAnaGlobResult.html#aff2b9a6e73aa921c763bf5df35d66bc2">Print</a>();
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    <span class="keywordflow">return</span> EXIT_SUCCESS;
<a name="l00235"></a>00235 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 3 Dec 2014 for cnipol by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
