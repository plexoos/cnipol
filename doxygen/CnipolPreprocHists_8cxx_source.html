<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>cnipol: /direct/eic+u/dsmirnov/cnipol/src/CnipolPreprocHists.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_e1dca166ec6abb4ef5a7ad269392aef6.html">src</a>
  </div>
</div>
<div class="contents">
<h1>CnipolPreprocHists.cxx</h1><a href="CnipolPreprocHists_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;<a class="code" href="CnipolPreprocHists_8h.html">CnipolPreprocHists.h</a>&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="preprocessor">#include &quot;TDirectoryFile.h&quot;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;TFitResultPtr.h&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;TH2F.h&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &quot;TH1F.h&quot;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &quot;TPaveStats.h&quot;</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;utils/utils.h&quot;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;<a class="code" href="AnaInfo_8h.html">AnaInfo.h</a>&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="AsymRoot_8h.html">AsymRoot.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="comment">//#include &quot;CnipolPulserHists.h&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="MeasInfo_8h.html">MeasInfo.h</a>&quot;</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <a class="code" href="AlphaCalibrator_8cxx.html#a2e4eff40c749ecbebe6e9a0ec9ed6c8d">ClassImp</a>(<a class="code" href="classCnipolPreprocHists.html">CnipolPreprocHists</a>)
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 using namespace std;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00022"></a><a class="code" href="classCnipolPreprocHists.html#a81bb246477d1fc6524f2b2d31d5082d7">00022</a> <a class="code" href="classCnipolPreprocHists.html">CnipolPreprocHists</a>::<a class="code" href="classCnipolPreprocHists.html">CnipolPreprocHists</a>() : <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a>()
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024    BookHists();
<a name="l00025"></a>00025 }
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="classCnipolPreprocHists.html#ac4064cdaeb5f839631a2c64c17b8f215">00028</a> <a class="code" href="classCnipolPreprocHists.html#a81bb246477d1fc6524f2b2d31d5082d7" title="Default constructor.">CnipolPreprocHists::CnipolPreprocHists</a>(TDirectory *dir) : <a class="code" href="classDrawObjContainer.html">DrawObjContainer</a>(dir)
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030    <a class="code" href="classCnipolPreprocHists.html#a8ecac33bed085fc80ea031ccae17ac19">BookHists</a>();
<a name="l00031"></a>00031 }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00035"></a><a class="code" href="classCnipolPreprocHists.html#a743465d6cc61e4b72734a387511ed31b">00035</a> <a class="code" href="classCnipolPreprocHists.html#a743465d6cc61e4b72734a387511ed31b" title="Default destructor.">CnipolPreprocHists::~CnipolPreprocHists</a>()
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037 }
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00041"></a><a class="code" href="classCnipolPreprocHists.html#a8ecac33bed085fc80ea031ccae17ac19">00041</a> <span class="keywordtype">void</span> <a class="code" href="classCnipolPreprocHists.html#a8ecac33bed085fc80ea031ccae17ac19">CnipolPreprocHists::BookHists</a>()
<a name="l00042"></a>00042 {
<a name="l00043"></a>00043    <span class="keywordtype">string</span> shName;
<a name="l00044"></a>00044    TH1*   hist;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046    <a class="code" href="classDrawObjContainer.html#a5bb4cfe27d6dbcc02627507a96f852df">fDir</a>-&gt;cd();
<a name="l00047"></a>00047 
<a name="l00048"></a>00048    <span class="comment">// Data from all enabled silicon channels</span>
<a name="l00049"></a>00049    <span class="comment">//shName = &quot;hTimeVsEnergyA&quot;;</span>
<a name="l00050"></a>00050    <span class="comment">//hist = new TH2S(shName.c_str(), shName.c_str(), 80, 100, 1700, 80, 20, 100);</span>
<a name="l00051"></a>00051    <span class="comment">//hist-&gt;SetTitle(&quot;; Deposited Energy, keV; Time, ns;&quot;);</span>
<a name="l00052"></a>00052    <span class="comment">//hist-&gt;SetOption(&quot;colz LOGZ NOIMG&quot;);</span>
<a name="l00053"></a>00053    <span class="comment">//o[shName] = hist;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055    shName = <span class="stringliteral">&quot;hsTimeVsEnergyACumul&quot;</span>;
<a name="l00056"></a>00056    <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName] = <span class="keyword">new</span> THStack(shName.c_str(), shName.c_str());
<a name="l00057"></a>00057 
<a name="l00058"></a>00058    <a class="code" href="AsymCommon_8h.html#a54f2d4199f80ef54d0ec9c501e2bf70f">ChannelSetIter</a> iCh = <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.begin();
<a name="l00059"></a>00059 
<a name="l00060"></a>00060    <span class="keywordflow">for</span> (; iCh!=<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.end(); ++iCh)
<a name="l00061"></a>00061    {
<a name="l00062"></a>00062       UShort_t chId = *iCh;
<a name="l00063"></a>00063       <span class="keywordtype">string</span>   sChId(<span class="stringliteral">&quot;  &quot;</span>);
<a name="l00064"></a>00064       sprintf(&amp;sChId[0], <span class="stringliteral">&quot;%02d&quot;</span>, chId);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066       <span class="comment">// Time vs energy from amplitude</span>
<a name="l00067"></a>00067       <span class="comment">// Time vs energy from amplitude special binning</span>
<a name="l00068"></a>00068       shName = <span class="stringliteral">&quot;hTimeVsEnergyA_ch&quot;</span> + sChId;
<a name="l00069"></a>00069       hist = <span class="keyword">new</span> TH2S(shName.c_str(), shName.c_str(), 1, 0, 1, 1, 0, 1);
<a name="l00070"></a>00070       hist-&gt;SetTitle(<span class="stringliteral">&quot;; Deposited Energy, keV; Time, ns;&quot;</span>);
<a name="l00071"></a>00071       hist-&gt;SetOption(<span class="stringliteral">&quot;colz LOGZ NOIMG&quot;</span>);
<a name="l00072"></a>00072       <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName] = hist;
<a name="l00073"></a>00073       fhTimeVsEnergyA_ch[chId-1] = hist;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075       shName = <span class="stringliteral">&quot;hFitMeanTimeVsEnergyA_ch&quot;</span> + sChId;
<a name="l00076"></a>00076       hist = <span class="keyword">new</span> TH1F(shName.c_str(), shName.c_str(), 1, 0, 1);
<a name="l00077"></a>00077       hist-&gt;SetTitle(<span class="stringliteral">&quot;; Deposited Energy, keV; Mean Time, ns;&quot;</span>);
<a name="l00078"></a>00078       hist-&gt;SetOption(<span class="stringliteral">&quot;E1 GRIDX NOIMG&quot;</span>);
<a name="l00079"></a>00079       hist-&gt;GetYaxis()-&gt;SetRangeUser(10, 110);
<a name="l00080"></a>00080       <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName] = hist;
<a name="l00081"></a>00081       fhFitMeanTimeVsEnergyA_ch[chId-1] = hist;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083       shName = <span class="stringliteral">&quot;hFitChi2NdfVsEnergyA_ch&quot;</span> + sChId;
<a name="l00084"></a>00084       hist = <span class="keyword">new</span> TH1F(shName.c_str(), shName.c_str(), 1, 0, 1);
<a name="l00085"></a>00085       hist-&gt;SetTitle(<span class="stringliteral">&quot;; Deposited Energy, keV; #chi^2/ndf;&quot;</span>);
<a name="l00086"></a>00086       hist-&gt;SetOption(<span class="stringliteral">&quot;P GRIDX&quot;</span>);
<a name="l00087"></a>00087       hist-&gt;SetMarkerStyle(kFullCircle);
<a name="l00088"></a>00088       hist-&gt;SetMarkerSize(0.8);
<a name="l00089"></a>00089       hist-&gt;SetMarkerColor(kGreen);
<a name="l00090"></a>00090       <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName] = hist;
<a name="l00091"></a>00091       fhFitChi2NdfVsEnergyA_ch[chId-1] = hist;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093       shName = <span class="stringliteral">&quot;hFitChi2NdfLogVsEnergyA_ch&quot;</span> + sChId;
<a name="l00094"></a>00094       hist = <span class="keyword">new</span> TH1F(shName.c_str(), shName.c_str(), 1, 0, 1);
<a name="l00095"></a>00095       hist-&gt;SetTitle(<span class="stringliteral">&quot;; Deposited Energy, keV; log(#chi^2/ndf);&quot;</span>);
<a name="l00096"></a>00096       hist-&gt;SetOption(<span class="stringliteral">&quot;P GRIDX&quot;</span>);
<a name="l00097"></a>00097       hist-&gt;SetMarkerStyle(kFullCircle);
<a name="l00098"></a>00098       hist-&gt;SetMarkerSize(0.8);
<a name="l00099"></a>00099       hist-&gt;SetMarkerColor(kGreen);
<a name="l00100"></a>00100       <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName] = hist;
<a name="l00101"></a>00101       fhFitChi2NdfLogVsEnergyA_ch[chId-1] = hist;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103       shName = <span class="stringliteral">&quot;hTimeVsEnergyACumul_ch&quot;</span> + sChId;
<a name="l00104"></a>00104       hist = <span class="keyword">new</span> TH1F(shName.c_str(), shName.c_str(), 100, 0, 1);
<a name="l00105"></a>00105       hist-&gt;SetOption(<span class="stringliteral">&quot;hist&quot;</span>);
<a name="l00106"></a>00106       hist-&gt;SetTitle(<span class="stringliteral">&quot;; Digi Channel Frac; Event Frac;&quot;</span>);
<a name="l00107"></a>00107       hist-&gt;SetLineWidth(2);
<a name="l00108"></a>00108       hist-&gt;SetLineColor(<a class="code" href="classRunConfig.html#a53cc5296e4bc66ab2a2dc83098bf337a">RunConfig::AsColor</a>(chId));
<a name="l00109"></a>00109       hist-&gt;GetYaxis()-&gt;SetRangeUser(0, 1);
<a name="l00110"></a>00110       <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[shName]                       = hist;
<a name="l00111"></a>00111       fhTimeVsEnergyACumul_ch[chId-1] = hist;
<a name="l00112"></a>00112       ((THStack*) <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[<span class="stringliteral">&quot;hsTimeVsEnergyACumul&quot;</span>])-&gt;Add(fhTimeVsEnergyACumul_ch[chId-1]);
<a name="l00113"></a>00113    }
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00118"></a><a class="code" href="classCnipolPreprocHists.html#aafa4de0ed7510a457229654e6b68a651">00118</a> <span class="keywordtype">void</span> <a class="code" href="classCnipolPreprocHists.html#aafa4de0ed7510a457229654e6b68a651">CnipolPreprocHists::FillPassOne</a>(<a class="code" href="classChannelEvent.html">ChannelEvent</a> *ch)
<a name="l00119"></a>00119 {
<a name="l00120"></a>00120    <span class="comment">//UChar_t chId = ch-&gt;GetChannelId();</span>
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    <span class="comment">//fhTimeVsEnergyA_ch[chId-1] -&gt; Fill(ch-&gt;GetEnergyA(), ch-&gt;GetTime());</span>
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00127"></a><a class="code" href="classCnipolPreprocHists.html#a2fa8ce7a0a978de6d33588b874616383">00127</a> <span class="keywordtype">void</span> <a class="code" href="classDrawObjContainer.html#ad138328d26535379e138ea80fe9ed8ce">CnipolPreprocHists::FillDerivedPassOne</a>(<a class="code" href="classDrawObjContainer.html">DrawObjContainer</a> &amp;oc)
<a name="l00128"></a>00128 {
<a name="l00130"></a>00130    <span class="comment">//if (!oc || oc-&gt;d.find(&quot;preproc_eb&quot;) == oc-&gt;d.end() ) {</span>
<a name="l00131"></a>00131    <span class="comment">//   Error(&quot;FillDerivedPassOne(DrawObjContainer &amp;oc)&quot;, &quot;No empty bunch container &apos;preproc_eb&apos; found&quot;);</span>
<a name="l00132"></a>00132    <span class="comment">//} else {</span>
<a name="l00133"></a>00133    <span class="comment">//   CnipolPreprocHists* ebHists = (CnipolPreprocHists*) oc-&gt;d.find(&quot;preproc_eb&quot;)-&gt;second;</span>
<a name="l00134"></a>00134    <span class="comment">//   FillDerivedPassOne_SubtractEmptyBunch(ebHists);</span>
<a name="l00135"></a>00135    <span class="comment">//}</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    <span class="comment">// A raw histogram container is required to fill TvsE histograms</span>
<a name="l00138"></a>00138    <span class="keywordflow">if</span> ( oc.<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>.find(<span class="stringliteral">&quot;raw_neb&quot;</span>) == oc.<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>.end() )
<a name="l00139"></a>00139    {
<a name="l00140"></a>00140       Error(<span class="stringliteral">&quot;FillDerivedPassOne(DrawObjContainer &amp;oc)&quot;</span>, <span class="stringliteral">&quot;No &apos;raw_neb&apos; histogram container found&quot;</span>);
<a name="l00141"></a>00141    } <span class="keywordflow">else</span> {
<a name="l00142"></a>00142       <a class="code" href="classCnipolRawHists.html">CnipolRawHists</a> *rawHists = (<a class="code" href="classCnipolRawHists.html">CnipolRawHists</a>*) oc.<a class="code" href="classDrawObjContainer.html#ae762b02a32ea3f1684da098342b93149">d</a>.find(<span class="stringliteral">&quot;raw_neb&quot;</span>)-&gt;second;
<a name="l00143"></a>00143       FillDerivedPassOne_FillFromRawHists(rawHists);
<a name="l00144"></a>00144    }
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 
<a name="l00149"></a><a class="code" href="classCnipolPreprocHists.html#a9d74bee1c84253aa2fec57068314ffa1">00149</a> <span class="keywordtype">void</span> <a class="code" href="classCnipolPreprocHists.html#a9d74bee1c84253aa2fec57068314ffa1">CnipolPreprocHists::PostFillPassOne</a>(<a class="code" href="classDrawObjContainer.html">DrawObjContainer</a> *oc)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151    Info(<span class="stringliteral">&quot;PostFillPassOne(DrawObjContainer *oc)&quot;</span>, <span class="stringliteral">&quot;Called&quot;</span>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153    <span class="comment">//CnipolPulserHists *pulserHists = (CnipolPulserHists *) oc-&gt;d.find(&quot;pulser&quot;)-&gt;second;</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155    <span class="comment">// Find proper normalization scale for pulser histograms</span>
<a name="l00156"></a>00156    <span class="comment">//TH1* hPulserTdc  = (TH1*) pulserHists-&gt;o.find(&quot;hTdc&quot;)-&gt;second;</span>
<a name="l00157"></a>00157    <span class="comment">//TH2* hPulserTvsA = (TH2*) pulserHists-&gt;o.find(&quot;hTvsA&quot;)-&gt;second;</span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159    <span class="comment">//TH2* hPulserTvsA = (TH2*) pulserHists-&gt;o.find(&quot;hTimeVsEnergyA&quot;)-&gt;second;</span>
<a name="l00160"></a>00160    <span class="comment">//TH1* hPulserTdc  = hPulserTvsA-&gt;ProjectionY(&quot;hTimeVsEnergyA_projy&quot;);</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162    <span class="comment">//Int_t cntTdcBin = hPulserTdc-&gt;GetMaximumBin();</span>
<a name="l00163"></a>00163 
<a name="l00164"></a>00164    <span class="comment">//Int_t minTdcBin = cntTdcBin - 1;</span>
<a name="l00165"></a>00165    <span class="comment">//Int_t maxTdcBin = cntTdcBin + 1;</span>
<a name="l00166"></a>00166 
<a name="l00168"></a>00168    <span class="comment">//TH1F* hPulserAdcMainPeak = hPulserTvsA-&gt;ProjectionX(&quot;hPulserAdcMainPeak&quot;, minTdcBin, maxTdcBin, &quot;eo&quot;);</span>
<a name="l00169"></a>00169 
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <span class="comment">//TFitResultPtr fitres = hPulserAdcMainPeak-&gt;Fit(&quot;gaus&quot;, &quot;E S&quot;, &quot;&quot;);</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="comment">//Double_t pulserAdcMean=0, pulserAdcMeanErr, pulserAdcSigma=0, pulserAdcSigmaErr;</span>
<a name="l00176"></a>00176 
<a name="l00177"></a>00177    <span class="comment">//if (fitres.Get()) {</span>
<a name="l00178"></a>00178    <span class="comment">//   pulserAdcMean     = fitres-&gt;Value(1);</span>
<a name="l00179"></a>00179    <span class="comment">//   pulserAdcMeanErr  = fitres-&gt;FitResult::Error(1);</span>
<a name="l00180"></a>00180    <span class="comment">//   pulserAdcSigma    = fitres-&gt;Value(2);</span>
<a name="l00181"></a>00181    <span class="comment">//   pulserAdcSigmaErr = fitres-&gt;FitResult::Error(2);</span>
<a name="l00182"></a>00182    <span class="comment">//}</span>
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    <span class="comment">//Int_t minAdcBin = hPulserAdcMainPeak-&gt;FindBin(pulserAdcMean - 2*pulserAdcSigma);</span>
<a name="l00185"></a>00185    <span class="comment">//Int_t maxAdcBin = hPulserAdcMainPeak-&gt;FindBin(pulserAdcMean + 2*pulserAdcSigma);</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187    <span class="comment">//delete hPulserAdcMainPeak;</span>
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="comment">//printf(&quot;%d, %d, %d, %d, %f, %f\n&quot;, minAdcBin, maxAdcBin, minTdcBin, maxTdcBin, pulserAdcMean, pulserAdcSigma);</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191    <span class="comment">// Fit 3 bins with a gaussian func</span>
<a name="l00192"></a>00192    <span class="comment">//hPulserTdc-&gt;FitSlicesX(0, maxValBin-1, maxValBin+1, 0, &quot;QNR G3&quot;, fitResHists);</span>
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00197"></a>00197 <span class="keywordtype">void</span> <a class="code" href="classCnipolPreprocHists.html#abe9b0af59402edf7c3bcdef16b9916f7">CnipolPreprocHists::SaveAllAs</a>(ImageFormat fmt_ext, TCanvas &amp;c, <span class="keywordtype">string</span> pattern, <span class="keywordtype">string</span> path, Bool_t thumbs)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199    <a class="code" href="classCnipolPreprocHists.html#abe9b0af59402edf7c3bcdef16b9916f7">DrawObjContainer::SaveAllAs</a>(fmt_ext, c, pattern, path, thumbs);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <span class="comment">// Draw superimposed histos</span>
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    <span class="keywordtype">string</span> strThumb = thumbs ? <span class="stringliteral">&quot;_thumb&quot;</span> : <span class="stringliteral">&quot;&quot;</span> ;
<a name="l00204"></a>00204    <span class="keywordtype">string</span> cName = <span class="stringliteral">&quot;c_combo&quot;</span>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <span class="comment">// Draw superimposed for all channels</span>
<a name="l00207"></a>00207    <a class="code" href="AsymCommon_8h.html#a54f2d4199f80ef54d0ec9c501e2bf70f">ChannelSetIter</a> iCh = <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.begin();
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    <span class="keywordflow">for</span> (; iCh!=<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.end(); ++iCh)
<a name="l00210"></a>00210    {
<a name="l00211"></a>00211       UShort_t chId = *iCh;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213       <span class="keywordtype">string</span> sSi(<span class="stringliteral">&quot;  &quot;</span>);
<a name="l00214"></a>00214       sprintf(&amp;sSi[0], <span class="stringliteral">&quot;%02d&quot;</span>, chId);
<a name="l00215"></a>00215       <span class="keywordtype">string</span> cName = <span class="stringliteral">&quot;c_combo_ch&quot;</span> + sSi + strThumb;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       THStack hstack(cName.c_str(), cName.c_str());
<a name="l00218"></a>00218 
<a name="l00219"></a>00219       TH1* h1 = (TH1*) fhTimeVsEnergyA_ch[chId-1];
<a name="l00220"></a>00220       hstack.Add(h1);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222       TH1* h2 = (TH1*) fhFitMeanTimeVsEnergyA_ch[chId-1];
<a name="l00223"></a>00223       hstack.Add(h2);
<a name="l00224"></a>00224 
<a name="l00225"></a>00225       <a class="code" href="classDrawObjContainer.html#a11f93ce07aa5e379168a96bc4a504015">SaveHStackAs</a>(c, hstack, path);
<a name="l00226"></a>00226    }
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00231"></a>00231 <span class="keywordtype">void</span> CnipolPreprocHists::FillDerivedPassOne_SubtractEmptyBunch(<a class="code" href="classCnipolPreprocHists.html">CnipolPreprocHists</a> *ebHists)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233 <span class="comment">/*</span>
<a name="l00234"></a>00234 <span class="comment">   TH2* hTimeVsEnergyA = (TH2*) o[&quot;hTimeVsEnergyA&quot;];</span>
<a name="l00235"></a>00235 <span class="comment"></span>
<a name="l00236"></a>00236 <span class="comment">   ChannelSetIter iCh = gMeasInfo-&gt;fSiliconChannels.begin();</span>
<a name="l00237"></a>00237 <span class="comment"></span>
<a name="l00238"></a>00238 <span class="comment">   for (; iCh!=gMeasInfo-&gt;fSiliconChannels.end(); ++iCh)</span>
<a name="l00239"></a>00239 <span class="comment">   {</span>
<a name="l00240"></a>00240 <span class="comment">      UShort_t chId = *iCh;</span>
<a name="l00241"></a>00241 <span class="comment"></span>
<a name="l00242"></a>00242 <span class="comment">      TH2* fhTimeVsEnergyA_ch_this = (TH2*) fhTimeVsEnergyA_ch[chId-1];</span>
<a name="l00243"></a>00243 <span class="comment">      TH2* fhTimeVsEnergyA_ch_eb   = (TH2*) ebHists-&gt;fhTimeVsEnergyA_ch[chId-1];</span>
<a name="l00244"></a>00244 <span class="comment"></span>
<a name="l00245"></a>00245 <span class="comment">      if ( !fhTimeVsEnergyA_ch_this || !fhTimeVsEnergyA_ch_eb ) {</span>
<a name="l00246"></a>00246 <span class="comment">         Error(&quot;FillDerivedPassOne_SubtractEmptyBunch&quot;, &quot;No empty bunch histogram found %s&quot;, fhTimeVsEnergyA_ch_this-&gt;GetName());</span>
<a name="l00247"></a>00247 <span class="comment">         continue;</span>
<a name="l00248"></a>00248 <span class="comment">      }</span>
<a name="l00249"></a>00249 <span class="comment"></span>
<a name="l00250"></a>00250 <span class="comment">      //Double_t sumPreproc = hPreproc_ch-&gt;Integral(minAdcBin, maxAdcBin, minTdcBin, maxTdcBin);</span>
<a name="l00251"></a>00251 <span class="comment">      //Double_t sumPulser  = hPulser_ch -&gt;Integral(minAdcBin, maxAdcBin, minTdcBin, maxTdcBin);</span>
<a name="l00252"></a>00252 <span class="comment"></span>
<a name="l00253"></a>00253 <span class="comment">      //Double_t area = (maxAdcBin + 1 - minAdcBin) * (maxTdcBin + 1 - minTdcBin);</span>
<a name="l00254"></a>00254 <span class="comment"></span>
<a name="l00256"></a>00256 <span class="comment"></span>
<a name="l00257"></a>00257 <span class="comment">      //for (Int_t ibx=minAdcBin; ibx&lt;=maxAdcBin; ibx++) {</span>
<a name="l00258"></a>00258 <span class="comment">      //   for (Int_t iby=minTdcBin; iby&lt;=maxTdcBin; iby++) {</span>
<a name="l00259"></a>00259 <span class="comment">      //      hPreproc_ch-&gt;SetBinContent(ibx, iby, sumPreproc/area);</span>
<a name="l00260"></a>00260 <span class="comment">      //      hPulser_ch -&gt;SetBinContent(ibx, iby, sumPulser/area);</span>
<a name="l00261"></a>00261 <span class="comment">      //   }</span>
<a name="l00262"></a>00262 <span class="comment">      //}</span>
<a name="l00263"></a>00263 <span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">      // Subtract empty bunch data from all bunch data</span>
<a name="l00265"></a>00265 <span class="comment">      fhTimeVsEnergyA_ch_eb-&gt;Scale( N_BUNCHES / (float) gMeasInfo-&gt;GetNumEmptyBunches());</span>
<a name="l00266"></a>00266 <span class="comment">      fhTimeVsEnergyA_ch_this-&gt;Add(fhTimeVsEnergyA_ch_eb, -1);</span>
<a name="l00267"></a>00267 <span class="comment"></span>
<a name="l00268"></a>00268 <span class="comment">      // After the subtraction set bins with negative content to 0 including under/overflows</span>
<a name="l00269"></a>00269 <span class="comment">      for (Int_t ibx=0; ibx&lt;=fhTimeVsEnergyA_ch_this-&gt;GetNbinsX()+1; ibx++) {</span>
<a name="l00270"></a>00270 <span class="comment">         for (Int_t iby=0; iby&lt;=fhTimeVsEnergyA_ch_this-&gt;GetNbinsY()+1; iby++) {</span>
<a name="l00271"></a>00271 <span class="comment"></span>
<a name="l00272"></a>00272 <span class="comment">            Double_t bc = fhTimeVsEnergyA_ch_this-&gt;GetBinContent(ibx, iby);</span>
<a name="l00273"></a>00273 <span class="comment"></span>
<a name="l00274"></a>00274 <span class="comment">            if (bc &lt; 0) {</span>
<a name="l00275"></a>00275 <span class="comment">               fhTimeVsEnergyA_ch_this-&gt;SetBinContent(ibx, iby, 0);</span>
<a name="l00276"></a>00276 <span class="comment">               fhTimeVsEnergyA_ch_this-&gt;SetBinError(ibx, iby, 0);</span>
<a name="l00277"></a>00277 <span class="comment">            }</span>
<a name="l00278"></a>00278 <span class="comment">         }</span>
<a name="l00279"></a>00279 <span class="comment">      }</span>
<a name="l00280"></a>00280 <span class="comment"></span>
<a name="l00281"></a>00281 <span class="comment">      hTimeVsEnergyA-&gt;Add(fhTimeVsEnergyA_ch_this);</span>
<a name="l00282"></a>00282 <span class="comment">   }</span>
<a name="l00283"></a>00283 <span class="comment">*/</span>
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00288"></a>00288 <span class="keywordtype">void</span> CnipolPreprocHists::FillDerivedPassOne_FillFromRawHists(<a class="code" href="classCnipolRawHists.html">CnipolRawHists</a> *rawHists)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290    TH1 *hNoiseReject = NULL;
<a name="l00291"></a>00291    
<a name="l00292"></a>00292    <a class="code" href="AsymCommon_8h.html#a54f2d4199f80ef54d0ec9c501e2bf70f">ChannelSetIter</a> iCh = <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.begin();
<a name="l00293"></a>00293 
<a name="l00294"></a>00294    <span class="keywordflow">for</span> (; iCh!=<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a0d2f475da9f0396f138e2e23018f6913">fSiliconChannels</a>.end(); ++iCh)
<a name="l00295"></a>00295    {
<a name="l00296"></a>00296       UShort_t chId                       = *iCh;
<a name="l00297"></a>00297       TH1*     hTvsA_ch                   = (TH1*) rawHists-&gt;<a class="code" href="classCnipolRawHists.html#ae5cce4bc2b258310ddc2789b00985d84">GetHTvsA_ch</a>(chId);   <span class="comment">// raw hist all - empty bunches</span>
<a name="l00298"></a>00298       TH1*     hTimeVsEnergyA_ch          = (TH1*) fhTimeVsEnergyA_ch[chId-1];
<a name="l00299"></a>00299       TH1*     hFitMeanTimeVsEnergyA_ch   = (TH1*) fhFitMeanTimeVsEnergyA_ch[chId-1];
<a name="l00300"></a>00300       TH1*     hFitChi2NdfVsEnergyA_ch    = (TH1*) fhFitChi2NdfVsEnergyA_ch[chId-1];
<a name="l00301"></a>00301       TH1*     hFitChi2NdfLogVsEnergyA_ch = (TH1*) fhFitChi2NdfLogVsEnergyA_ch[chId-1];
<a name="l00302"></a>00302 
<a name="l00303"></a>00303       UShort_t adcMin = TMath::Max(<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#abf09e4c7edb587d85286668f9472fb67">GetProtoCutAdcMin</a>(), (UShort_t) hTvsA_ch-&gt;GetXaxis()-&gt;GetXmin());
<a name="l00304"></a>00304       UShort_t adcMax = TMath::Min(<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#ae231236adfc14359a8cc9f60fb698d64">GetProtoCutAdcMax</a>(), (UShort_t) hTvsA_ch-&gt;GetXaxis()-&gt;GetXmax());
<a name="l00305"></a>00305       UShort_t tdcMin = TMath::Max(<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a9edb1158d1d2bd30c0b3cf225f6f71f7">GetProtoCutTdcMin</a>(), (UShort_t) hTvsA_ch-&gt;GetYaxis()-&gt;GetXmin());
<a name="l00306"></a>00306       UShort_t tdcMax = TMath::Min(<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#ab4269b9974bbfb5470e7a4a88be72ff9">GetProtoCutTdcMax</a>(), (UShort_t) hTvsA_ch-&gt;GetYaxis()-&gt;GetXmax());
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       Int_t nXBins = adcMax - adcMin;
<a name="l00309"></a>00309       Int_t nYBins = tdcMax - tdcMin;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311       <span class="keyword">const</span> <a class="code" href="classCalibrator.html">Calibrator</a> *calibrator = <a class="code" href="AsymCommon_8cxx.html#ae26181acb46d02c57996a31d6627e0ee">gAsymRoot</a>-&gt;<a class="code" href="classAsymRoot.html#a1a1fac3fd2127d5bc0b01c0e6e712031">GetCalibrator</a>();
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       Float_t xMin = calibrator-&gt;<a class="code" href="classCalibrator.html#a7adeb44c7cd7a450bde804e4b93c0254" title="Returns energy registered by channel chId.">GetEnergyA</a>(adcMin, chId);
<a name="l00314"></a>00314       Float_t xMax = calibrator-&gt;<a class="code" href="classCalibrator.html#a7adeb44c7cd7a450bde804e4b93c0254" title="Returns energy registered by channel chId.">GetEnergyA</a>(adcMax, chId);
<a name="l00315"></a>00315       Float_t yMin = calibrator-&gt;<a class="code" href="classCalibrator.html#a341765bb1f1f8282e3a57b2cee138666">GetTime</a>(tdcMin);
<a name="l00316"></a>00316       Float_t yMax = calibrator-&gt;<a class="code" href="classCalibrator.html#a341765bb1f1f8282e3a57b2cee138666">GetTime</a>(tdcMax);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318       hTimeVsEnergyA_ch-&gt;SetBins(nXBins, xMin, xMax, nYBins, yMin, yMax);
<a name="l00319"></a>00319       hFitMeanTimeVsEnergyA_ch-&gt;SetBins(nXBins, xMin, xMax);
<a name="l00320"></a>00320       hFitChi2NdfVsEnergyA_ch-&gt;SetBins(nXBins, xMin, xMax);
<a name="l00321"></a>00321       hFitChi2NdfLogVsEnergyA_ch-&gt;SetBins(nXBins, xMin, xMax);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323       Short_t extraOffset = 0;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325       <span class="keywordflow">if</span> ( UInt_t(<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a41415c151cc2df84cef2407f6e1f5e49">GetBeamEnergy</a>() + 0.5) != <a class="code" href="AsymCommon_8h.html#a27fa7e1c3dafe1ff85fce6d38d8af11ca4103a22544dbf81b29558b16da96fb66">kINJECTION</a>)
<a name="l00326"></a>00326          extraOffset = -8; <span class="comment">// 8 TDC units ~= 9 ns</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328       <span class="comment">//utils::CopyBinContentError(hTvsA_ch, hTimeVsEnergyA_ch);</span>
<a name="l00329"></a>00329       <span class="keywordflow">for</span> (Int_t biny=1; biny&lt;=nYBins; biny++) {
<a name="l00330"></a>00330          <span class="keywordflow">for</span> (Int_t binx=1; binx&lt;=nXBins; binx++) {
<a name="l00331"></a>00331 
<a name="l00332"></a>00332             Int_t binAdc = <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#abf09e4c7edb587d85286668f9472fb67">GetProtoCutAdcMin</a>() - 1 + binx;
<a name="l00333"></a>00333             Int_t binTdc = <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a9edb1158d1d2bd30c0b3cf225f6f71f7">GetProtoCutTdcMin</a>() - 1 + biny;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             <span class="comment">// Apply the &quot;proto slope&quot; cut</span>
<a name="l00336"></a>00336             <span class="keywordflow">if</span> ( fabs( binTdc - ( <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#aa24758b545c95a9f41b47522fe20ceae">GetProtoCutSlope</a>() * binAdc + <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a46b633247ed1be5d86cf8fec130f7a40">GetProtoCutOffset</a>() + extraOffset) ) &gt; 20 )
<a name="l00337"></a>00337                <span class="keywordflow">continue</span>;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339             <span class="comment">//printf(&quot;binx, biny, slope, offset: %d, %d, %f, %f\n&quot;, binx, biny, gMeasInfo-&gt;GetProtoCutSlope(), gMeasInfo-&gt;GetProtoCutOffset());</span>
<a name="l00340"></a>00340             <span class="comment">//if ( fabs( (Float_t) biny - ( gMeasInfo-&gt;GetProtoCutSlope() * (Float_t) binx + gMeasInfo-&gt;GetProtoCutOffset() + extraOffset) ) &gt; 20 )</span>
<a name="l00341"></a>00341             <span class="comment">//   continue;</span>
<a name="l00342"></a>00342 
<a name="l00343"></a>00343             Double_t bc = hTvsA_ch-&gt;GetBinContent(binAdc, binTdc);
<a name="l00344"></a>00344             Double_t be = hTvsA_ch-&gt;GetBinError(binAdc, binTdc);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346             hTimeVsEnergyA_ch-&gt;SetBinContent(binx, biny, bc);
<a name="l00347"></a>00347             hTimeVsEnergyA_ch-&gt;SetBinError(binx, biny, be);
<a name="l00348"></a>00348          }
<a name="l00349"></a>00349       }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351       <span class="comment">// Calculate cumulative histograms</span>
<a name="l00352"></a>00352       utils::ConvertToCumulative2(hTimeVsEnergyA_ch, (TH1F*) fhTimeVsEnergyACumul_ch[chId-1]);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       <span class="comment">// Set energy-dependent noise rejection</span>
<a name="l00355"></a>00355       Float_t areaFrac1, evntFrac1, areaFrac2, evntFrac2;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357       <span class="keywordflow">if</span> (<a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a41415c151cc2df84cef2407f6e1f5e49">GetBeamEnergy</a>() &gt; 200) {
<a name="l00358"></a>00358          <span class="comment">// 10% of bins contain &gt; 90% of events</span>
<a name="l00359"></a>00359          <span class="comment">// 2%  of bins contain &gt; 40% of events</span>
<a name="l00360"></a>00360          areaFrac1 = 0.12; evntFrac1 = 0.80; areaFrac2 = 0.02; evntFrac2 = 0.40;
<a name="l00361"></a>00361       } <span class="keywordflow">else</span> {
<a name="l00362"></a>00362          <span class="comment">// 15% of bins contain &gt; 75% of events</span>
<a name="l00363"></a>00363          <span class="comment">// 2%  of bins contain &gt; 30% of events</span>
<a name="l00364"></a>00364          areaFrac1 = 0.15; evntFrac1 = 0.75; areaFrac2 = 0.02; evntFrac2 = 0.30;
<a name="l00365"></a>00365       }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367       <span class="comment">// Add graphical representation of the above requirements to the</span>
<a name="l00368"></a>00368       <span class="comment">// histogram stack</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370       TAttLine lineStyle(kViolet, 3, 4);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372       TLine *line1_horz = <span class="keyword">new</span> TLine(0, evntFrac1, areaFrac1, evntFrac1);
<a name="l00373"></a>00373       TLine *line1_vert = <span class="keyword">new</span> TLine(areaFrac1, 0, areaFrac1, evntFrac1);
<a name="l00374"></a>00374       TLine *line2_horz = <span class="keyword">new</span> TLine(0, evntFrac2, areaFrac2, evntFrac2);
<a name="l00375"></a>00375       TLine *line2_vert = <span class="keyword">new</span> TLine(areaFrac2, 0, areaFrac2, evntFrac2);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377       lineStyle.Copy(*line1_horz);
<a name="l00378"></a>00378       lineStyle.Copy(*line1_vert);
<a name="l00379"></a>00379       lineStyle.Copy(*line2_horz);
<a name="l00380"></a>00380       lineStyle.Copy(*line2_vert);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382       ((TH1*) fhTimeVsEnergyACumul_ch[chId-1])-&gt;GetListOfFunctions()-&gt;Add(line1_horz);
<a name="l00383"></a>00383       ((TH1*) fhTimeVsEnergyACumul_ch[chId-1])-&gt;GetListOfFunctions()-&gt;Add(line1_vert);
<a name="l00384"></a>00384       ((TH1*) fhTimeVsEnergyACumul_ch[chId-1])-&gt;GetListOfFunctions()-&gt;Add(line2_horz);
<a name="l00385"></a>00385       ((TH1*) fhTimeVsEnergyACumul_ch[chId-1])-&gt;GetListOfFunctions()-&gt;Add(line2_vert);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387       <span class="keywordtype">string</span>   sChId(<span class="stringliteral">&quot;  &quot;</span>);
<a name="l00388"></a>00388       sprintf(&amp;sChId[0], <span class="stringliteral">&quot;%02d&quot;</span>, chId);
<a name="l00389"></a>00389       <span class="keywordtype">string</span> shName = <span class="stringliteral">&quot;noise_reject&quot;</span> + sChId;
<a name="l00390"></a>00390       TH1 *hist = <span class="keyword">new</span> TH2C(shName.c_str(), shName.c_str(), 1, 0, 1, 1, 0, 1);
<a name="l00391"></a>00391       hist-&gt;GetListOfFunctions()-&gt;Add(line1_horz);
<a name="l00392"></a>00392       hist-&gt;GetListOfFunctions()-&gt;Add(line1_vert);
<a name="l00393"></a>00393       hist-&gt;GetListOfFunctions()-&gt;Add(line2_horz);
<a name="l00394"></a>00394       hist-&gt;GetListOfFunctions()-&gt;Add(line2_vert);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396       hNoiseReject = hist;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398       <span class="comment">// Point 1</span>
<a name="l00399"></a>00399       <span class="keywordflow">if</span> (fhTimeVsEnergyACumul_ch[chId-1]-&gt;GetBinContent(areaFrac1*100) &gt; evntFrac1) {
<a name="l00400"></a>00400          <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a68cd44b370663ed7984bcfe4bbfdbfa2">DisableChannel</a>(chId);
<a name="l00401"></a>00401          <span class="keywordflow">continue</span>;
<a name="l00402"></a>00402       }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404       <span class="comment">// Point 2</span>
<a name="l00405"></a>00405       <span class="keywordflow">if</span> (fhTimeVsEnergyACumul_ch[chId-1]-&gt;GetBinContent(areaFrac2*100) &gt; evntFrac2) {
<a name="l00406"></a>00406          <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a68cd44b370663ed7984bcfe4bbfdbfa2">DisableChannel</a>(chId);
<a name="l00407"></a>00407          <span class="keywordflow">continue</span>;
<a name="l00408"></a>00408       }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410       <span class="comment">// now check if the &quot;area&quot; (i.e. the number of bins) filled with events</span>
<a name="l00411"></a>00411       <span class="comment">// is ridicuolosly small</span>
<a name="l00412"></a>00412       <span class="comment">//hTvsA_ch-&gt;Print(&quot;all&quot;);</span>
<a name="l00413"></a>00413       <span class="comment">//hTimeVsEnergyA_ch-&gt;Print(&quot;all&quot;);</span>
<a name="l00414"></a>00414       Double_t frac = utils::GetNonEmptyFraction(hTimeVsEnergyA_ch);
<a name="l00415"></a>00415       Info(<span class="stringliteral">&quot;FillDerivedPassOne_FillFromRawHists&quot;</span>, <span class="stringliteral">&quot;Non empty bin fraction %f. Channel %d (disable if &lt; 0.10)&quot;</span>, frac, chId);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417       <span class="keywordflow">if</span> ( frac &lt; 0.10 ) {
<a name="l00418"></a>00418          <a class="code" href="AsymCommon_8cxx.html#a4ea09dca810048da3a6c153c741478c2">gMeasInfo</a>-&gt;<a class="code" href="classMeasInfo.html#a68cd44b370663ed7984bcfe4bbfdbfa2">DisableChannel</a>(chId);
<a name="l00419"></a>00419          <span class="keywordflow">continue</span>;
<a name="l00420"></a>00420       }
<a name="l00421"></a>00421    }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    <span class="comment">// use the last noise reject histo</span>
<a name="l00424"></a>00424    ((THStack*) <a class="code" href="classDrawObjContainer.html#ae288a17ad6e0151b408beaf77f3e69d9">o</a>[<span class="stringliteral">&quot;hsTimeVsEnergyACumul&quot;</span>])-&gt;Add((TH1*) hNoiseReject-&gt;Clone(<span class="stringliteral">&quot;noise_reject_hs&quot;</span>));
<a name="l00425"></a>00425 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 3 Dec 2014 for cnipol by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
